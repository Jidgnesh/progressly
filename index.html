<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#7c3aed">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Planner">
  <meta name="description" content="Personal monthly planner with task progress tracking">
  <title>My Planner</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f172a; }
    input[type="range"] { -webkit-appearance: none; background: #334155; border-radius: 8px; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: #8b5cf6; border-radius: 50%; cursor: pointer; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const PRIORITIES = { high: '#ef4444', medium: '#f59e0b', low: '#22c55e' };
    const CATEGORIES = ['Work', 'Personal', 'Health', 'Learning', 'Other'];
    const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    const Icon = ({ name, size = 24, className = '', color }) => {
      const ref = React.useRef();
      useEffect(() => {
        if (ref.current) {
          ref.current.innerHTML = '';
          const icon = lucide.createElement(lucide.icons[name]);
          icon.setAttribute('width', size);
          icon.setAttribute('height', size);
          if (color) icon.setAttribute('stroke', color);
          ref.current.appendChild(icon);
        }
      }, [name, size, color]);
      return <span ref={ref} className={className} style={{display: 'inline-flex'}} />;
    };

    function App() {
      const [tasks, setTasks] = useState([]);
      const [currentMonth, setCurrentMonth] = useState(new Date().getMonth());
      const [currentYear, setCurrentYear] = useState(new Date().getFullYear());
      const [showAdd, setShowAdd] = useState(false);
      const [newTask, setNewTask] = useState({ title: '', priority: 'medium', category: 'Work' });
      const [loading, setLoading] = useState(true);
      const [filter, setFilter] = useState('all');
      const [expandedTask, setExpandedTask] = useState(null);

      useEffect(() => {
        const saved = localStorage.getItem('planner-tasks-v3');
        if (saved) setTasks(JSON.parse(saved));
        setLoading(false);
      }, []);

      const saveTasks = (newTasks) => {
        setTasks(newTasks);
        localStorage.setItem('planner-tasks-v3', JSON.stringify(newTasks));
      };

      const addTask = () => {
        if (!newTask.title.trim()) return;
        const task = { id: Date.now(), ...newTask, month: currentMonth, year: currentYear, progress: 0 };
        saveTasks([...tasks, task]);
        setNewTask({ title: '', priority: 'medium', category: 'Work' });
        setShowAdd(false);
      };

      const updateProgress = (id, progress) => {
        saveTasks(tasks.map(t => t.id === id ? { ...t, progress: Math.min(100, Math.max(0, progress)) } : t));
      };

      const deleteTask = (id) => {
        saveTasks(tasks.filter(t => t.id !== id));
        if (expandedTask === id) setExpandedTask(null);
      };

      const changeMonth = (delta) => {
        let m = currentMonth + delta, y = currentYear;
        if (m > 11) { m = 0; y++; } if (m < 0) { m = 11; y--; }
        setCurrentMonth(m); setCurrentYear(y);
      };

      const monthTasks = tasks.filter(t => t.month === currentMonth && t.year === currentYear);
      const completedCount = monthTasks.filter(t => t.progress === 100).length;
      const totalCount = monthTasks.length;
      const avgProgress = totalCount > 0 ? Math.round(monthTasks.reduce((s, t) => s + t.progress, 0) / totalCount) : 0;
      const inProgressCount = monthTasks.filter(t => t.progress > 0 && t.progress < 100).length;

      const filteredTasks = monthTasks.filter(t => {
        if (filter === 'pending') return t.progress < 100;
        if (filter === 'completed') return t.progress === 100;
        if (filter === 'inprogress') return t.progress > 0 && t.progress < 100;
        return true;
      });

      const sortedTasks = filteredTasks.sort((a, b) => {
        if ((a.progress === 100) !== (b.progress === 100)) return a.progress === 100 ? 1 : -1;
        return { high: 0, medium: 1, low: 2 }[a.priority] - { high: 0, medium: 1, low: 2 }[b.priority];
      });

      const getProgressColor = (p) => p === 100 ? '#22c55e' : p >= 75 ? '#84cc16' : p >= 50 ? '#eab308' : p >= 25 ? '#f97316' : '#64748b';

      if (loading) return <div className="min-h-screen bg-slate-900 flex items-center justify-center text-slate-400">Loading...</div>;

      return (
        <div className="min-h-screen bg-slate-900 text-white pb-24">
          <div className="bg-gradient-to-r from-violet-600 to-indigo-600 px-4 pt-10 pb-6">
            <h1 className="text-2xl font-bold mb-1">My Planner</h1>
            <p className="text-violet-200 text-sm">Track progress on every task</p>
          </div>

          <div className="bg-slate-800 px-4 py-4 flex items-center justify-between">
            <button onClick={() => changeMonth(-1)} className="p-2 hover:bg-slate-700 rounded-full"><Icon name="ChevronLeft" size={24}/></button>
            <div className="text-center">
              <div className="text-xl font-bold">{MONTHS[currentMonth]}</div>
              <div className="text-slate-400 text-sm">{currentYear}</div>
            </div>
            <button onClick={() => changeMonth(1)} className="p-2 hover:bg-slate-700 rounded-full"><Icon name="ChevronRight" size={24}/></button>
          </div>

          <div className="mx-4 mt-4 bg-slate-800 rounded-2xl p-5">
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-3">
                <div className="w-14 h-14 rounded-xl flex items-center justify-center relative">
                  <svg className="w-14 h-14" style={{transform:'rotate(-90deg)'}}>
                    <circle cx="28" cy="28" r="24" stroke="#334155" strokeWidth="6" fill="none"/>
                    <circle cx="28" cy="28" r="24" stroke="#8b5cf6" strokeWidth="6" fill="none" strokeDasharray={`${avgProgress*1.51} 151`} strokeLinecap="round"/>
                  </svg>
                  <span className="absolute text-sm font-bold">{avgProgress}%</span>
                </div>
                <div>
                  <div className="text-lg font-semibold">Overall Progress</div>
                  <div className="text-slate-400 text-sm">{totalCount} total tasks</div>
                </div>
              </div>
            </div>
            <div className="flex justify-between pt-4 border-t border-slate-700">
              <div className="text-center"><div className="text-xl font-bold text-orange-400">{totalCount - completedCount - inProgressCount}</div><div className="text-xs text-slate-400">Not Started</div></div>
              <div className="text-center"><div className="text-xl font-bold text-yellow-400">{inProgressCount}</div><div className="text-xs text-slate-400">In Progress</div></div>
              <div className="text-center"><div className="text-xl font-bold text-green-400">{completedCount}</div><div className="text-xs text-slate-400">Completed</div></div>
            </div>
          </div>

          <div className="flex gap-2 px-4 mt-4 overflow-x-auto">
            {[['all','All'],['pending','To Do'],['inprogress','In Progress'],['completed','Done']].map(([k,l])=>(
              <button key={k} onClick={()=>setFilter(k)} className={`px-4 py-2 rounded-xl text-sm font-medium whitespace-nowrap ${filter===k?'bg-violet-600':'bg-slate-800 text-slate-400'}`}>{l}</button>
            ))}
          </div>

          <div className="px-4 mt-4">
            <div className="flex items-center gap-2 mb-3"><Icon name="ListTodo" size={18} color="#a78bfa"/><span className="font-medium">Tasks</span></div>
            {sortedTasks.length === 0 ? (
              <div className="text-center py-12 text-slate-500"><Icon name="Circle" size={48}/><p className="mt-3">{filter==='all'?'No tasks this month':'No tasks here'}</p></div>
            ) : (
              <div className="space-y-3">
                {sortedTasks.map(task => (
                  <div key={task.id} className={`bg-slate-800 rounded-xl overflow-hidden ${task.progress===100?'opacity-70':''}`}>
                    <div className="p-4 flex items-center gap-3 cursor-pointer" onClick={()=>setExpandedTask(expandedTask===task.id?null:task.id)}>
                      <div className="relative w-10 h-10 flex-shrink-0">
                        <svg className="w-10 h-10" style={{transform:'rotate(-90deg)'}}>
                          <circle cx="20" cy="20" r="16" stroke="#334155" strokeWidth="4" fill="none"/>
                          <circle cx="20" cy="20" r="16" stroke={getProgressColor(task.progress)} strokeWidth="4" fill="none" strokeDasharray={`${task.progress*1.005} 100.5`} strokeLinecap="round"/>
                        </svg>
                        <span className="absolute inset-0 flex items-center justify-center text-xs font-bold">{task.progress}</span>
                      </div>
                      <div className="flex-1 min-w-0">
                        <p className={`font-medium ${task.progress===100?'line-through text-slate-500':''}`}>{task.title}</p>
                        <div className="flex items-center gap-2 mt-1">
                          <span className="text-xs px-2 py-0.5 rounded-full" style={{backgroundColor:PRIORITIES[task.priority]+'22',color:PRIORITIES[task.priority]}}>{task.priority}</span>
                          <span className="text-xs text-slate-500">{task.category}</span>
                        </div>
                      </div>
                      <button onClick={(e)=>{e.stopPropagation();deleteTask(task.id);}} className="p-2 text-slate-500"><Icon name="Trash2" size={18}/></button>
                    </div>
                    <div className="px-4 pb-2"><div className="h-2 bg-slate-700 rounded-full overflow-hidden"><div className="h-full rounded-full transition-all" style={{width:`${task.progress}%`,backgroundColor:getProgressColor(task.progress)}}/></div></div>
                    {expandedTask===task.id && (
                      <div className="px-4 pb-4 pt-2 border-t border-slate-700 mt-2">
                        <div className="text-sm text-slate-400 mb-3">Update Progress</div>
                        <div className="flex gap-2 mb-4">
                          {[0,25,50,75,100].map(v=>(
                            <button key={v} onClick={()=>updateProgress(task.id,v)} className={`flex-1 py-2 rounded-lg text-sm font-medium ${task.progress===v?'ring-2 ring-violet-500':'bg-slate-700'}`} style={task.progress===v?{backgroundColor:getProgressColor(v)}:{}}>{v}%</button>
                          ))}
                        </div>
                        <div className="flex items-center gap-3">
                          <button onClick={()=>updateProgress(task.id,task.progress-5)} className="w-12 h-12 bg-slate-700 rounded-xl flex items-center justify-center"><Icon name="Minus" size={20}/></button>
                          <input type="range" min="0" max="100" value={task.progress} onChange={(e)=>updateProgress(task.id,parseInt(e.target.value))} className="flex-1 h-2"/>
                          <button onClick={()=>updateProgress(task.id,task.progress+5)} className="w-12 h-12 bg-slate-700 rounded-xl flex items-center justify-center"><Icon name="Plus" size={20}/></button>
                        </div>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>

          <button onClick={()=>setShowAdd(true)} className="fixed bottom-6 right-6 w-14 h-14 bg-violet-600 rounded-full flex items-center justify-center shadow-lg"><Icon name="Plus" size={28}/></button>

          {showAdd && (
            <div className="fixed inset-0 bg-black/70 z-50 flex items-end">
              <div className="bg-slate-800 w-full rounded-t-3xl p-6 max-h-[85vh] overflow-y-auto">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-xl font-bold">Add Task</h2>
                  <button onClick={()=>setShowAdd(false)} className="text-slate-400 text-2xl">Ã—</button>
                </div>
                <input type="text" placeholder="What's your task?" value={newTask.title} onChange={(e)=>setNewTask({...newTask,title:e.target.value})} className="w-full bg-slate-700 rounded-xl px-4 py-4 mb-4 outline-none text-lg text-white" autoFocus/>
                <div className="mb-4">
                  <label className="text-sm text-slate-400 mb-2 block">Category</label>
                  <div className="flex flex-wrap gap-2">
                    {CATEGORIES.map(c=>(<button key={c} onClick={()=>setNewTask({...newTask,category:c})} className={`px-4 py-2 rounded-xl text-sm font-medium ${newTask.category===c?'bg-violet-600':'bg-slate-700 text-slate-400'}`}>{c}</button>))}
                  </div>
                </div>
                <div className="mb-6">
                  <label className="text-sm text-slate-400 mb-2 block">Priority</label>
                  <div className="flex gap-2">
                    {Object.entries(PRIORITIES).map(([k,c])=>(<button key={k} onClick={()=>setNewTask({...newTask,priority:k})} className={`flex-1 py-3 rounded-xl capitalize font-medium ${newTask.priority===k?'ring-2 ring-offset-2 ring-offset-slate-800':'opacity-50'}`} style={{backgroundColor:c+'33',color:c}}>{k}</button>))}
                  </div>
                </div>
                <button onClick={addTask} disabled={!newTask.title.trim()} className="w-full bg-violet-600 py-4 rounded-xl font-bold text-lg disabled:opacity-50">Add Task</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>